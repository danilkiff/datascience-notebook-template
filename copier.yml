# SPDX-License-Identifier: Unlicense
_min_copier_version: "9.0.0"

_subdirectory: ""

_skip_if_exists:
  - .env

_exclude:
  - "{% if not gpu_support %}docker-compose.gpu.yaml{% endif %}"

_templates_suffix: .jinja

_tasks:
  - "python3 -c \"import pathlib; f=pathlib.Path('.env.example'); f.write_text(f.read_text().replace('COMPOSE_PROJECT_NAME=my-ml-project','COMPOSE_PROJECT_NAME={{ project_name }}'))\""
  - "python3 -c \"import pathlib; f=pathlib.Path('README.md'); f.write_text(f.read_text().replace('# JupyterLab data science environment','# {{ project_name }}',1))\""
  - >-
    {% if ml_framework == 'pytorch' %}
    python3 -c "import pathlib; f=pathlib.Path('requirements/jupyter.in'); f.write_text(f.read_text().replace('fastai==2.8.6','torch==2.9.1\ntorchvision==0.24.1'))"
    {% elif ml_framework == 'none' %}
    python3 -c "import pathlib; f=pathlib.Path('requirements/jupyter.in'); lines=[l for l in f.read_text().splitlines(True) if not l.startswith('fastai==')]; f.write_text(''.join(lines))"
    {% endif %}
  - "echo 'Run: make lock && make build to finalize setup.'"

project_name:
  type: str
  help: Project name (used in container labels and README)
  default: my-ml-project
  validator: "{% if not project_name %}Project name cannot be empty{% endif %}"

author:
  type: str
  help: Author name
  default: ""

ml_framework:
  type: str
  help: Primary ML framework to include
  choices:
    fastai: fastai
    pytorch: PyTorch (standalone)
    none: None (scipy-notebook only)
  default: fastai

gpu_support:
  type: bool
  help: Include GPU support overlay?
  default: true
